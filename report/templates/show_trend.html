{% extends '_layouts/base.html' %}

{% load startswith %}
{% block title %} Trend for build {{ build_name }}  {% endblock %}

{% block headline %}<h1>Trend for Build {{ build_name }}</h1>{% endblock %}

{% block javascript %}
{% if trend_data %}
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    google.charts.load('current', {'packages':['line']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
        var data = new google.visualization.DataTable();
        data.addColumn('number', 'Build Number');
        {% for test_case in test_cases %}
        data.addColumn('number', '{{ test_case }}');
        {% endfor %}

        data.addRows([
        {% for one_build in trend_data %}
            [{{ one_build.build_no }},
            {% with one_build.test_cases_res as test_cases_res %}
            {% for test_case_res in test_cases_res %}
                {{test_case_res.measurement}},
            {% endfor %}
            {% endwith %}
            ],
        {% endfor %}
            ]);

        var options = {
            chart: {
                title: 'Trend Chart for {{ build_name }} on {{ chart_title }} ',
                //subtitle: 'in millions of dollars (USD)'
            },
            width: 1200,
            height: 500
        };

        var chart = new google.charts.Line(document.getElementById('linechart_material'));

        chart.draw(data, google.charts.Line.convertOptions(options));
    }
</script>
{% endif %}
{% endblock %}
{% block content %}
{% if trend_data %}
<h2>Trend Chart</h2>
<div id="linechart_material" style="width: 1200px; height: 500px"></div>

<h2>Data List</h2>
<table border=2>
<tr>
    <th>Build Number</th>
    {% for test_case in test_cases %}
    <th>{{ test_case }}</th>
    {% endfor %}
</tr>
{% for one_build in trend_data %}
<tr>
	<td align="left"> <a href="/report/test-report/?build_name={{ build_name }}&build_no={{ one_build.build_no }}">{{ one_build.build_no }}</a></td>
	{% with one_build.test_cases_res as test_cases_res %}
	{% for test_case_res in test_cases_res %}
	<td align="right"> {{test_case_res.measurement}} </td>
	{% endfor %}
	{% endwith %}
</tr>
{% endfor %}
</table>
{% else %}
<div>
	No history data yet.<br/>
	Please go to the test report page to check: <a href="/report/test-report/?build_name={{ build_name }}">{{ build_name }}</a>
</div>
{% endif %}

{% endblock %}
